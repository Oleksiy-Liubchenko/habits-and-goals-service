{% extends "base.html" %}

{% block content%}

  <h1>Habit detail</h1>

  <br>

  <h1>{{ habit.name }}</h1>
  (start - {{ habit.created_at }})
  <h4>description:</h4>{{ habit.description }}
  <h3>month goal:</h3> {{ habit.month_goal }}
{#  <h2>Today check:</h2> {{ habit_completions.get_status_display }}#}
  <br>

  {% if not completion_status_today %}
  <form method="POST">
    {% csrf_token %}
    <div class="form-check">
      {{ form.as_p }}
    </div>
    <button type="submit" class="btn btn-primary">Submit</button>
  </form>
  {% endif %}

  {# ------ #}
{#  !!!!!! {{ habit.habit_completions.all }}#}
{# ------ #}
{#  {% url "tracker:habit-completion-update" pk=habit.pk completion_pk=completion.pk %}#}

{% if habit.habit_completions.all %}
  <h2>Completion history:</h2>
  {% for completion in habit.habit_completions.all %}
{#  <a href="{% url "tracker:habit-completion-update" pk=habit.pk completion_pk=completion.pk %}" class="btn btn-primary">#}
{#    Update today status#}
{#  </a>#}
{% endfor %}
  <br><br>
    total days from start = {{ total_days }}
    <br>
    days complete = {{ completed_days }}
    <br>
    days ignored = {{ ignored_days }}
    <br>
    days pass = {{ not_completed_days }}
    <br>
    focus % = {{ progress_percent }}  %
  <div style="display: flex; align-items: center;">
    <p style="margin-right: 10px;">
    </p>

    <div class="progress" style="width: 20%;">
      <div class="progress-bar" role="progressbar" style="width: {{ progress_percent }}%;"
           aria-valuenow="50" aria-valuemin="0" aria-valuemax="100">
        {{ progress_percent }}
      </div>
    </div>
  </div>

    <br>
  <ul>
    {% regroup habit.habit_completions.all by complete_date|date:"Y-m-d" as completion_grouped %}
    {% for group in completion_grouped %}
      {% with group.list|last as completion %}
        <li>
          {{ completion.complete_date }} - {{ completion.get_status_display }}
{#          <a href="{% url "tracker:habit-completion-update" pk=habit.pk completion_pk=completion.pk %}">#}
{#            Update#}
{#          </a>#}
        </li>
      {% endwith %}
    {% endfor %}
  </ul>
{% endif %}


  <br>
    <br><br>
    <a href="{% url "tracker:habit-commentary-create" pk=habit.id%}">
        Create commentary
    </a>
  <br>
      Comment zone:
    <ul>
    {% for comment in habit_commentaries %}
      <li>
        <h2>{{ comment.text }}</h2>
        (Comment by: {{ comment.user }} at {{ comment.created_at.time }} {{ comment.created_at.date }})
      </li>
    {% empty %}
      <p>No comments yet.</p>
    {% endfor %}
  </ul>
{% endblock %}